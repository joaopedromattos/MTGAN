# -*- coding: utf-8 -*-
"""dataset_collection

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1lHElNaOJc6KguYAQuFrWGjVqDUUk3an8
"""
import os
from requests import get
import pandas as pd
import numpy as np
from tqdm import tqdm


os.system("wget https://mtgjson.com/api/v5/AllPrintingsCSVFiles.tar.gz && tar xvzf AllPrintingsCSVFiles.tar.gz")

cards = pd.read_csv('./AllPrintingsCSVFiles/cards.csv', low_memory=False)

cards_ids = cards.query('layout == "normal"')['scryfallId'].to_numpy()

API_ENDPOINT = "https://api.scryfall.com/cards/"
DATASET_FOLDER = "../raw/"
for i in tqdm(cards_ids, unit="image", initial=0):

        # Get our response from the API_ENDPOINT
        response = get(API_ENDPOINT + i)

        # From the API_ENDPOINT, we retrieve the image url
        # that contains our desired illustration
        image_url = response.json()["image_uris"]['art_crop']

        # Retrieving an image stream.
        image_response = get(image_url)

        # image_response will be a blob file stream,
        # so we'll write it in a .jpg binary file (image)
        file = open(DATASET_FOLDER + i + '.jpg', "wb")
        file.write(image_response.content)
        file.close()
